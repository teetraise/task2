{
  "info": {
    "name": "Construction Management API",
    "description": "Complete API collection with tests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8000"
    },
    {
      "key": "token",
      "value": ""
    },
    {
      "key": "userId",
      "value": ""
    },
    {
      "key": "orderId",
      "value": ""
    }
  ],
  "item": [
    {
      "name": "01. Auth - Register (Valid)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 201', () => {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test('Response has token', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.true;",
              "    pm.expect(jsonData.data).to.have.property('token');",
              "    pm.collectionVariables.set('token', jsonData.data.token);",
              "    pm.collectionVariables.set('userId', jsonData.data.user._id);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"test{{$timestamp}}@example.com\",\n  \"password\": \"password123\",\n  \"name\": \"Test User\",\n  \"role\": \"client\",\n  \"phone\": \"+1234567890\",\n  \"company\": \"Test Company\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/v1/auth/register",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "auth", "register"]
        }
      }
    },
    {
      "name": "02. Auth - Register (Duplicate Email)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 409', () => {",
              "    pm.response.to.have.status(409);",
              "});",
              "",
              "pm.test('Error message for duplicate email', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.false;",
              "    pm.expect(jsonData.error.code).to.equal('CONFLICT');",
              "});"
            ]
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "pm.collectionVariables.set('duplicateEmail', 'duplicate' + Date.now() + '@example.com');",
              "",
              "pm.sendRequest({",
              "    url: pm.collectionVariables.get('baseUrl') + '/v1/auth/register',",
              "    method: 'POST',",
              "    header: {'Content-Type': 'application/json'},",
              "    body: {",
              "        mode: 'raw',",
              "        raw: JSON.stringify({",
              "            email: pm.collectionVariables.get('duplicateEmail'),",
              "            password: 'password123',",
              "            name: 'Duplicate User'",
              "        })",
              "    }",
              "}, (err, res) => {});",
              "",
              "setTimeout(() => {}, 500);"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{duplicateEmail}}\",\n  \"password\": \"password123\",\n  \"name\": \"Test User\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/v1/auth/register",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "auth", "register"]
        }
      }
    },
    {
      "name": "03. Auth - Login (Valid)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Returns token', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.true;",
              "    pm.expect(jsonData.data.token).to.be.a('string');",
              "});"
            ]
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "const loginEmail = 'login' + Date.now() + '@example.com';",
              "pm.collectionVariables.set('loginEmail', loginEmail);",
              "",
              "pm.sendRequest({",
              "    url: pm.collectionVariables.get('baseUrl') + '/v1/auth/register',",
              "    method: 'POST',",
              "    header: {'Content-Type': 'application/json'},",
              "    body: {",
              "        mode: 'raw',",
              "        raw: JSON.stringify({",
              "            email: loginEmail,",
              "            password: 'password123',",
              "            name: 'Login Test User'",
              "        })",
              "    }",
              "}, (err, res) => {});",
              "",
              "setTimeout(() => {}, 500);"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{loginEmail}}\",\n  \"password\": \"password123\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/v1/auth/login",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "auth", "login"]
        }
      }
    },
    {
      "name": "04. Auth - Login (Invalid Password)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 401', () => {",
              "    pm.response.to.have.status(401);",
              "});",
              "",
              "pm.test('Error for invalid credentials', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.false;",
              "    pm.expect(jsonData.error.code).to.equal('UNAUTHORIZED');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{loginEmail}}\",\n  \"password\": \"wrongpassword\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/v1/auth/login",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "auth", "login"]
        }
      }
    },
    {
      "name": "05. Auth - Get Profile (With Token)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Returns user data', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.true;",
              "    pm.expect(jsonData.data).to.have.property('email');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{token}}"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/v1/auth/profile",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "auth", "profile"]
        }
      }
    },
    {
      "name": "06. Auth - Register Admin User",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 201', () => {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "const jsonData = pm.response.json();",
              "pm.collectionVariables.set('adminToken', jsonData.data.token);"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"admin{{$timestamp}}@example.com\",\n  \"password\": \"admin123456\",\n  \"name\": \"Admin User\",\n  \"role\": \"admin\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/v1/auth/register",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "auth", "register"]
        }
      }
    },
    {
      "name": "07. Users - Get All (Admin)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Returns users list with pagination', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.true;",
              "    pm.expect(jsonData.data.users).to.be.an('array');",
              "    pm.expect(jsonData.data.pagination).to.exist;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{adminToken}}"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/v1/users?page=1&limit=10",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "users"],
          "query": [
            {"key": "page", "value": "1"},
            {"key": "limit", "value": "10"}
          ]
        }
      }
    },
    {
      "name": "08. Users - Get All (Non-Admin Forbidden)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 403', () => {",
              "    pm.response.to.have.status(403);",
              "});",
              "",
              "pm.test('Forbidden error', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.false;",
              "    pm.expect(jsonData.error.code).to.equal('FORBIDDEN');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{token}}"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/v1/users",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "users"]
        }
      }
    },
    {
      "name": "09. Users - Update Profile",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Profile updated', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.true;",
              "    pm.expect(jsonData.data.name).to.equal('Updated Name');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{token}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Updated Name\",\n  \"phone\": \"+9876543210\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/v1/auth/profile",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "auth", "profile"]
        }
      }
    },
    {
      "name": "10. Orders - Create (With Token)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 201', () => {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test('Order created', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.true;",
              "    pm.expect(jsonData.data).to.have.property('_id');",
              "    pm.collectionVariables.set('orderId', jsonData.data._id);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{token}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"title\": \"Build new office {{$timestamp}}\",\n  \"description\": \"Construction of new office building\",\n  \"priority\": \"high\",\n  \"dueDate\": \"2024-12-31\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/v1/orders",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "orders"]
        }
      }
    },
    {
      "name": "11. Orders - Create (Without Token)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 401', () => {",
              "    pm.response.to.have.status(401);",
              "});",
              "",
              "pm.test('Unauthorized error', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.false;",
              "    pm.expect(jsonData.error.code).to.equal('UNAUTHORIZED');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"title\": \"Test order\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/v1/orders",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "orders"]
        }
      }
    },
    {
      "name": "12. Orders - Get Own Order",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Order retrieved', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.true;",
              "    pm.expect(jsonData.data.title).to.exist;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{token}}"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/v1/orders/{{orderId}}",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "orders", "{{orderId}}"]
        }
      }
    },
    {
      "name": "13. Orders - Get List With Pagination",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Returns orders with pagination', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.true;",
              "    pm.expect(jsonData.data.orders).to.be.an('array');",
              "    pm.expect(jsonData.data.pagination).to.exist;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{token}}"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/v1/orders?page=1&limit=10&status=created",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "orders"],
          "query": [
            {"key": "page", "value": "1"},
            {"key": "limit", "value": "10"},
            {"key": "status", "value": "created"}
          ]
        }
      }
    },
    {
      "name": "14. Orders - Register Manager",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "const jsonData = pm.response.json();",
              "pm.collectionVariables.set('managerToken', jsonData.data.token);"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"manager{{$timestamp}}@example.com\",\n  \"password\": \"manager123\",\n  \"name\": \"Manager User\",\n  \"role\": \"manager\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/v1/auth/register",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "auth", "register"]
        }
      }
    },
    {
      "name": "15. Orders - Update Status (Manager)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Status updated', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.true;",
              "    pm.expect(jsonData.data.status).to.equal('in_progress');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{managerToken}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"status\": \"in_progress\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/v1/orders/{{orderId}}/status",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "orders", "{{orderId}}", "status"]
        }
      }
    },
    {
      "name": "16. Orders - Update Status (Client Forbidden)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 403', () => {",
              "    pm.response.to.have.status(403);",
              "});",
              "",
              "pm.test('Forbidden error', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.false;",
              "    pm.expect(jsonData.error.code).to.equal('FORBIDDEN');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{token}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"status\": \"completed\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/v1/orders/{{orderId}}/status",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "orders", "{{orderId}}", "status"]
        }
      }
    },
    {
      "name": "17. Orders - Create Second Order for Cancel Test",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "const jsonData = pm.response.json();",
              "pm.collectionVariables.set('cancelOrderId', jsonData.data._id);"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{token}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"title\": \"Order to cancel {{$timestamp}}\",\n  \"priority\": \"low\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{baseUrl}}/v1/orders",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "orders"]
        }
      }
    },
    {
      "name": "18. Orders - Cancel Own Order",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Order cancelled', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.true;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{token}}"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/v1/orders/{{cancelOrderId}}",
          "host": ["{{baseUrl}}"],
          "path": ["v1", "orders", "{{cancelOrderId}}"]
        }
      }
    },
    {
      "name": "19. System - Health Check",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Service is healthy', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.status).to.exist;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/health",
          "host": ["{{baseUrl}}"],
          "path": ["health"]
        }
      }
    }
  ]
}
